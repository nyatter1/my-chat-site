<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nyatter / The Global Grid</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --glass-bg: rgba(10, 10, 20, 0.6);
            --glass-border: rgba(255, 255, 255, 0.08);
            --accent-gradient: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
        }

        body { 
            font-family: 'Outfit', sans-serif; 
            background: #020617; 
            background-image: 
                radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.15) 0px, transparent 50%), 
                radial-gradient(at 100% 0%, rgba(168, 85, 247, 0.15) 0px, transparent 50%);
            color: #f8fafc; 
            height: 100vh; 
            overflow: hidden; 
        }

        /* --- UI UTILITIES --- */
        .glass-panel { 
            background: var(--glass-bg); 
            backdrop-filter: blur(24px); 
            border: 1px solid var(--glass-border); 
        }
        
        .rainbow-text { 
            background: linear-gradient(to right, #ff4d4d, #f97316, #fbbf24, #4ade80, #60a5fa, #a855f7); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            font-weight: 900; 
            letter-spacing: -1px;
        }

        .custom-scroll::-webkit-scrollbar { width: 5px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.2); }

        /* --- ANIMATIONS & INTERACTIONS --- */
        .btn-primary { 
            background: var(--accent-gradient); 
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.3); 
            transition: all 0.2s ease;
        }
        .btn-primary:hover { transform: scale(1.02); box-shadow: 0 0 30px rgba(99, 102, 241, 0.5); }
        .btn-primary:active { transform: scale(0.98); }

        .input-field {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            transition: all 0.3s;
        }
        .input-field:focus { border-color: #6366f1; box-shadow: 0 0 15px rgba(99, 102, 241, 0.2); }

        /* --- SPECIFIC COMPONENTS --- */
        .post-card { border-bottom: 1px solid var(--glass-border); transition: background 0.2s; }
        .post-card:hover { background: rgba(255,255,255,0.02); }

        .my-tag { background: rgba(251, 191, 36, 0.15); color: #fbbf24; border: 1px solid rgba(251, 191, 36, 0.3); padding: 1px 6px; border-radius: 6px; }
        .other-tag { color: #818cf8; font-weight: 700; }
        
        .notif-badge { position: absolute; top: -2px; right: -2px; width: 10px; height: 10px; background: #ef4444; border-radius: 50%; border: 2px solid #0f172a; display: none; box-shadow: 0 0 10px #ef4444; }

        .modal-overlay { background: rgba(2, 6, 23, 0.85); backdrop-filter: blur(12px); }
        
        /* PFP Styles */
        .pfp-preview { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 2px dashed rgba(255,255,255,0.2); }
        .user-avatar { object-fit: cover; background: #1e293b; }
    </style>
</head>
<body class="flex justify-center text-sm sm:text-base">

    <div id="auth-ui" class="fixed inset-0 z-[500] flex items-center justify-center p-4">
        <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-indigo-500/20 rounded-full blur-[100px]"></div>
        <div class="absolute bottom-1/4 right-1/4 w-96 h-96 bg-purple-500/20 rounded-full blur-[100px]"></div>

        <div class="relative w-full max-w-[420px] glass-panel p-8 rounded-[2rem] shadow-2xl flex flex-col">
            <div class="text-center mb-8">
                <h1 class="text-5xl mb-2 rainbow-text">NYATTER</h1>
                <p class="text-slate-400 font-light tracking-widest uppercase text-xs">Join the Frequency</p>
            </div>

            <div id="login-section" class="space-y-4 animate-fade-in">
                <div class="space-y-2">
                    <label class="text-xs font-bold text-slate-500 uppercase ml-2">Identity</label>
                    <input type="text" id="login-id" placeholder="Username or Email" class="w-full p-4 rounded-xl outline-none input-field text-white">
                </div>
                <div class="space-y-2">
                    <label class="text-xs font-bold text-slate-500 uppercase ml-2">Passcode</label>
                    <input type="password" id="login-pass" placeholder="Password" class="w-full p-4 rounded-xl outline-none input-field text-white">
                </div>
                <button onclick="performLogin()" class="w-full py-4 mt-4 btn-primary rounded-xl font-bold text-white uppercase tracking-widest text-sm">Initialize Session</button>
                <div class="text-center mt-6">
                    <p class="text-slate-500">No signal found? <button onclick="toggleAuthMode()" class="text-indigo-400 font-bold hover:underline">Establish Uplink (Signup)</button></p>
                </div>
            </div>

            <div id="signup-section" class="hidden space-y-4 animate-fade-in">
                <div class="flex justify-center mb-4">
                    <label class="cursor-pointer group relative">
                        <img id="signup-pfp-preview" src="https://via.placeholder.com/150/333?text=+" class="pfp-preview transition-all group-hover:border-indigo-500">
                        <input type="file" id="signup-pfp-input" class="hidden" accept="image/*" onchange="previewSignupPfp(event)">
                        <div class="absolute inset-0 flex items-center justify-center bg-black/50 rounded-full opacity-0 group-hover:opacity-100 transition-opacity text-[10px] font-bold uppercase">Upload</div>
                    </label>
                </div>
                
                <div class="grid grid-cols-1 gap-3">
                    <input type="text" id="reg-user" placeholder="Create Username" class="w-full p-3 rounded-xl outline-none input-field text-white">
                    <input type="email" id="reg-email" placeholder="Email Address" class="w-full p-3 rounded-xl outline-none input-field text-white">
                    <input type="password" id="reg-pass" placeholder="Create Password" class="w-full p-3 rounded-xl outline-none input-field text-white">
                </div>

                <button onclick="performSignup()" class="w-full py-4 btn-primary rounded-xl font-bold text-white uppercase tracking-widest text-sm">Create Identity</button>
                <div class="text-center mt-4">
                    <p class="text-slate-500">Already registered? <button onclick="toggleAuthMode()" class="text-indigo-400 font-bold hover:underline">Access Login</button></p>
                </div>
            </div>
            
            <div id="auth-error" class="hidden mt-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg text-red-200 text-xs text-center font-bold"></div>
        </div>
    </div>

    <div id="notif-overlay" class="fixed inset-0 z-[400] hidden modal-overlay flex items-center justify-center">
        <div class="w-full max-w-md bg-slate-900 border border-indigo-500/30 p-6 rounded-3xl shadow-[0_0_50px_rgba(99,102,241,0.2)] relative transform scale-100 transition-transform">
            <button onclick="toggleNotifs()" class="absolute top-4 right-4 w-8 h-8 flex items-center justify-center bg-white/5 rounded-full hover:bg-red-500/20 text-slate-400 hover:text-red-500 transition-colors">‚úï</button>
            
            <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
                <span class="text-3xl">üîî</span> Incoming Alerts
            </h2>
            
            <div id="notif-list" class="max-h-[60vh] overflow-y-auto custom-scroll space-y-2 pr-2">
                </div>
            
            <div class="mt-6 pt-4 border-t border-white/5 text-center">
                <p class="text-[10px] text-slate-500 uppercase tracking-widest">End of Transmission</p>
            </div>
        </div>
    </div>

    <div id="app-ui" class="hidden w-full max-w-[1500px] flex h-screen relative">
        
        <aside class="w-[280px] flex flex-col p-6 border-r border-white/5 bg-slate-900/40 backdrop-blur-sm">
            <div class="mb-12 px-2"><span class="text-2xl rainbow-text">NYATTER</span></div>
            
            <nav class="flex-1 space-y-4">
                <div class="group flex items-center gap-4 px-4 py-3 text-lg font-bold text-white bg-indigo-600/20 rounded-2xl border border-indigo-500/30 cursor-pointer transition-all">
                    <span class="group-hover:scale-110 transition-transform">üè†</span> <span class="tracking-wide">Home Base</span>
                </div>
                <div onclick="toggleNotifs()" class="group flex items-center gap-4 px-4 py-3 text-lg font-bold text-slate-400 hover:text-white hover:bg-white/5 rounded-2xl transition-all cursor-pointer relative">
                    <span class="group-hover:scale-110 transition-transform">üîî</span> Alerts
                    <div id="notif-dot" class="notif-badge"></div>
                </div>
            </nav>

            <div class="mt-auto p-4 bg-black/20 rounded-2xl border border-white/5">
                <div class="flex items-center gap-3">
                    <img id="current-user-pfp" src="default.png" class="w-10 h-10 rounded-full user-avatar border border-white/10">
                    <div class="overflow-hidden">
                        <p class="font-bold text-sm truncate text-white" id="user-display"></p>
                        <div id="dev-tag" class="hidden"><span class="text-[10px] bg-indigo-500 text-white px-2 rounded-full font-bold">DEV</span></div>
                    </div>
                </div>
                <button onclick="logout()" class="w-full mt-3 py-2 text-[10px] font-bold text-red-400 bg-red-500/10 hover:bg-red-500/20 rounded-lg transition-colors uppercase tracking-widest">Terminate Signal</button>
            </div>
        </aside>

        <main class="flex-1 flex flex-col glass-panel border-y-0 h-full relative z-10">
            <header class="p-6 border-b border-white/5 bg-slate-900/80 backdrop-blur-xl sticky top-0 z-20 flex justify-between items-center">
                <h2 class="text-xl font-bold tracking-tight">Global Feed</h2>
                <div class="flex items-center gap-2 text-[10px] font-bold text-emerald-400 bg-emerald-500/10 px-3 py-1 rounded-full border border-emerald-500/20">
                    <div class="w-1.5 h-1.5 bg-emerald-400 rounded-full animate-pulse"></div>
                    LIVE
                </div>
            </header>

            <div class="flex-1 overflow-y-auto custom-scroll" id="feed-scroll">
                <div class="p-6 border-b border-white/5 bg-gradient-to-b from-indigo-500/5 to-transparent">
                    <div class="flex gap-4">
                        <img id="composer-pfp" src="default.png" class="w-12 h-12 rounded-full user-avatar shadow-lg">
                        <div class="flex-1">
                            <textarea id="post-input" placeholder="What is happening in your sector?" class="w-full bg-transparent text-lg outline-none resize-none h-20 pt-2 text-white placeholder-slate-500"></textarea>
                            <div id="preview-area" class="mb-4"></div>
                            
                            <div class="flex justify-between items-center pt-2">
                                <label class="cursor-pointer text-xl p-2 hover:bg-white/10 rounded-full transition-colors text-indigo-400">
                                    üñºÔ∏è<input type="file" class="hidden" accept="image/*" onchange="previewPostImage(event)">
                                </label>
                                <button onclick="sendPost()" class="px-8 py-2 btn-primary rounded-full font-bold text-white text-xs uppercase tracking-widest">Broadcast</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="feed-container"></div>
                <div class="h-20"></div> </div>
        </main>

        <aside class="w-[320px] p-6 border-l border-white/5 bg-slate-900/40 backdrop-blur-sm hidden lg:block">
            <div class="glass-panel p-6 rounded-3xl h-full flex flex-col">
                <h3 class="text-xs font-black text-slate-500 uppercase tracking-widest mb-6 flex items-center gap-2">
                    <span class="w-2 h-2 bg-indigo-500 rounded-full"></span>
                    Citizens
                </h3>
                <div id="user-list" class="space-y-4 overflow-y-auto custom-scroll flex-1 pr-2">
                    </div>
                
                <div class="mt-4 pt-4 border-t border-white/5 text-center">
                    <p class="text-[10px] text-slate-600">Nyatter System v3.0</p>
                </div>
            </div>
        </aside>

    </div>

    <script>
        // --- GLOBAL STATE ---
        let currentUser = null;
        let currentPfp = null; // Stores Base64 of logged in user
        let userCache = {}; // Stores username -> pfp mapping
        let postImage = null;
        let signupPfpData = null;
        let isTyping = false;
        const ADMIN = "HaydenDev";
        const DEFAULT_PFP = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23ccc'%3E%3Cpath d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z'/%3E%3C/svg%3E";

        // --- INIT ---
        window.onload = () => {
            const savedUser = JSON.parse(localStorage.getItem('nyatter_session'));
            if (savedUser) {
                currentUser = savedUser.username;
                currentPfp = savedUser.pfp || DEFAULT_PFP;
                loadApp();
            }
        };

        // --- AUTH FUNCTIONS ---
        function toggleAuthMode() {
            const loginEl = document.getElementById('login-section');
            const signupEl = document.getElementById('signup-section');
            const isLogin = !loginEl.classList.contains('hidden');
            
            if (isLogin) {
                loginEl.classList.add('hidden');
                signupEl.classList.remove('hidden');
            } else {
                loginEl.classList.remove('hidden');
                signupEl.classList.add('hidden');
            }
            document.getElementById('auth-error').classList.add('hidden');
        }

        function previewSignupPfp(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = () => {
                signupPfpData = reader.result;
                document.getElementById('signup-pfp-preview').src = signupPfpData;
            };
            reader.readAsDataURL(file);
        }

        async function performSignup() {
            const username = document.getElementById('reg-user').value.trim();
            const email = document.getElementById('reg-email').value.trim();
            const password = document.getElementById('reg-pass').value.trim();
            
            if(!username || !email || !password) return showAuthError("All fields required.");

            try {
                const res = await fetch('/api/signup', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ username, email, password, pfp: signupPfpData || DEFAULT_PFP })
                });
                const data = await res.json();
                
                if (data.error) throw new Error(data.error);
                
                // Auto login on success
                completeLogin(data.user.username, data.user.pfp);
            } catch (e) {
                showAuthError(e.message);
            }
        }

        async function performLogin() {
            const identifier = document.getElementById('login-id').value.trim();
            const password = document.getElementById('login-pass').value.trim();
            
            try {
                const res = await fetch('/api/login', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ identifier, password })
                });
                const data = await res.json();
                
                if (data.error) throw new Error(data.error);
                
                completeLogin(data.user.username, data.user.pfp);
            } catch (e) {
                showAuthError(e.message);
            }
        }

        function completeLogin(username, pfp) {
            currentUser = username;
            currentPfp = pfp || DEFAULT_PFP;
            localStorage.setItem('nyatter_session', JSON.stringify({ username, pfp: currentPfp }));
            loadApp();
        }

        function loadApp() {
            document.getElementById('auth-ui').classList.add('hidden');
            document.getElementById('app-ui').classList.remove('hidden');
            document.getElementById('user-display').innerText = "@" + currentUser;
            document.getElementById('current-user-pfp').src = currentPfp;
            document.getElementById('composer-pfp').src = currentPfp;
            
            if(currentUser === ADMIN) document.getElementById('dev-tag').classList.remove('hidden');

            refreshAll();
            setInterval(() => { if(!isTyping) refreshAll(); }, 4000);
        }

        function showAuthError(msg) {
            const el = document.getElementById('auth-error');
            el.innerText = msg;
            el.classList.remove('hidden');
        }

        // --- APP DATA LOGIC ---
        async function refreshAll() {
            await fetchUsers(); // Get PFPs first
            await renderFeed();
            await checkNotifs();
        }

        async function fetchUsers() {
            try {
                const res = await fetch('/api/users');
                const users = await res.json();
                
                // Update Cache
                users.forEach(u => {
                    userCache[u.username] = u.pfp || DEFAULT_PFP;
                });

                // Update Sidebar
                document.getElementById('user-list').innerHTML = users.map(u => `
                    <div class="flex items-center gap-3 p-2 hover:bg-white/5 rounded-xl transition-colors cursor-default">
                        <img src="${u.pfp || DEFAULT_PFP}" class="w-10 h-10 rounded-full user-avatar border border-indigo-500/20">
                        <div>
                            <p class="text-sm font-bold text-slate-200">@${u.username}</p>
                            <p class="text-[10px] text-slate-500 font-mono">SIGNAL ACTIVE</p>
                        </div>
                    </div>
                `).join('');
            } catch(e) {}
        }

        function getUserPfp(username) {
            return userCache[username] || DEFAULT_PFP;
        }

        // --- FEED LOGIC ---
        function previewPostImage(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = () => {
                postImage = reader.result;
                document.getElementById('preview-area').innerHTML = `<img src="${postImage}" class="h-32 rounded-xl border border-indigo-500/50 mt-2">`;
            };
            reader.readAsDataURL(file);
        }

        async function sendPost() {
            const text = document.getElementById('post-input').value.trim();
            if(!text && !postImage) return;

            await fetch('/api/posts', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ user: currentUser, text, img: postImage })
            });

            document.getElementById('post-input').value = "";
            document.getElementById('preview-area').innerHTML = "";
            postImage = null;
            renderFeed();
        }

        async function sendReply(id) {
            const input = document.getElementById(`reply-${id}`);
            if(!input.value.trim()) return;

            await fetch('/api/posts/reply', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ id, user: currentUser, text: input.value })
            });
            isTyping = false;
            renderFeed();
        }

        // --- ADMIN & SOCIAL ---
        async function deletePost(id) {
            if(!confirm("Erase data permanently?")) return;
            await fetch('/api/posts/delete', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ id, user: currentUser })
            });
            renderFeed();
        }

        async function togglePin(id) {
            await fetch('/api/posts/pin', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ id, user: currentUser })
            });
            renderFeed();
        }

        async function toggleLike(id) {
            await fetch('/api/posts/like', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ id, user: currentUser })
            });
            renderFeed();
        }

        // --- RENDERER ---
        function parseText(text) {
            return text.replace(/@(\w+)/g, (match, name) => {
                const isMe = name === currentUser;
                return `<span class="${isMe ? 'my-tag' : 'other-tag'}">${match}</span>`;
            });
        }

        async function renderFeed() {
            try {
                const res = await fetch('/api/posts');
                const posts = await res.json();
                const container = document.getElementById('feed-container');

                container.innerHTML = posts.map(p => `
                    <div class="p-6 post-card ${p.pinned ? 'bg-indigo-900/10 border-l-2 border-l-amber-400' : ''}">
                        <div class="flex gap-4">
                            <img src="${getUserPfp(p.user)}" class="w-12 h-12 rounded-full user-avatar border border-white/10 shrink-0">
                            <div class="flex-1 min-w-0">
                                <div class="flex justify-between items-start">
                                    <div class="flex items-center gap-2">
                                        <span class="font-bold text-white text-base">@${p.user}</span>
                                        ${p.user === ADMIN ? '<span class="bg-indigo-500 text-[9px] px-1.5 py-0.5 rounded text-white font-bold">DEV</span>' : ''}
                                        ${p.pinned ? '<span class="text-amber-400 text-[10px] font-bold tracking-widest">üìå PINNED</span>' : ''}
                                    </div>
                                    <div class="flex gap-3 opacity-60 hover:opacity-100 transition-opacity">
                                        ${currentUser === ADMIN ? `<button onclick="togglePin('${p._id}')" class="text-[10px] uppercase font-bold text-slate-400 hover:text-amber-400">Pin</button>` : ''}
                                        ${(p.user === currentUser || currentUser === ADMIN) ? `<button onclick="deletePost('${p._id}')" class="text-[10px] uppercase font-bold text-slate-400 hover:text-red-500">Delete</button>` : ''}
                                    </div>
                                </div>
                                
                                <div class="mt-2 text-slate-200 leading-relaxed whitespace-pre-wrap font-light">${parseText(p.text)}</div>
                                ${p.img ? `<img src="${p.img}" class="mt-3 rounded-2xl w-full border border-white/5 shadow-2xl max-h-[400px] object-cover">` : ''}

                                <div class="flex gap-6 mt-4 pb-2 border-b border-white/5">
                                    <button onclick="toggleLike('${p._id}')" class="flex items-center gap-2 text-xs font-bold ${p.likes?.includes(currentUser) ? 'text-pink-500' : 'text-slate-500 hover:text-pink-400'} transition-colors">
                                        ‚ù§Ô∏è ${p.likes?.length || 0}
                                    </button>
                                    <div class="flex items-center gap-2 text-xs font-bold text-slate-500">
                                        üí¨ ${p.replies?.length || 0}
                                    </div>
                                </div>

                                <div class="mt-4 space-y-4">
                                    ${p.replies?.map(r => `
                                        <div class="flex gap-3">
                                            <img src="${getUserPfp(r.user)}" class="w-8 h-8 rounded-full user-avatar border border-white/5">
                                            <div class="bg-white/5 rounded-r-xl rounded-bl-xl p-3 flex-1 text-sm">
                                                <span class="text-indigo-400 font-bold block text-xs mb-1">@${r.user}</span>
                                                <span class="text-slate-300 font-light">${parseText(r.text)}</span>
                                            </div>
                                        </div>
                                    `).join('') || ''}
                                    
                                    <div class="flex gap-3 pt-2">
                                        <input id="reply-${p._id}" 
                                            onfocus="isTyping=true" 
                                            onblur="setTimeout(()=>isTyping=false, 200)"
                                            placeholder="Write a reply..." 
                                            class="flex-1 bg-slate-900/50 border border-white/10 rounded-xl px-4 py-2 text-xs text-white outline-none focus:border-indigo-500/50 transition-all">
                                        <button onclick="sendReply('${p._id}')" class="text-indigo-400 font-black text-[10px] uppercase tracking-widest hover:text-white">Send</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch(e) {}
        }

        // --- NOTIFICATIONS ---
        function toggleNotifs() {
            const overlay = document.getElementById('notif-overlay');
            overlay.classList.toggle('hidden');
        }

        async function checkNotifs() {
            const res = await fetch(`/api/notifications/${currentUser}`);
            const data = await res.json();
            
            const dot = document.getElementById('notif-dot');
            dot.style.display = data.length > 0 ? 'block' : 'none';

            const list = document.getElementById('notif-list');
            list.innerHTML = data.map(n => `
                <div class="bg-indigo-900/20 border border-indigo-500/20 p-4 rounded-2xl flex justify-between items-center group hover:bg-indigo-900/30 transition-colors">
                    <div class="flex items-center gap-3">
                        <img src="${getUserPfp(n.fromUser)}" class="w-8 h-8 rounded-full">
                        <div>
                            <p class="text-sm text-indigo-200">
                                <span class="font-bold text-white">@${n.fromUser}</span> tagged you
                            </p>
                            <p class="text-[10px] text-slate-500">Just now</p>
                        </div>
                    </div>
                    <button onclick="clearNotif('${n._id}')" class="w-6 h-6 flex items-center justify-center rounded-full bg-white/5 hover:bg-red-500 text-slate-400 hover:text-white transition-all">‚úï</button>
                </div>
            `).join('') || `<div class="text-center py-10 opacity-30 text-4xl">üì≠</div>`;
        }

        async function clearNotif(id) {
            await fetch('/api/notifications/clear', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ id })
            });
            checkNotifs();
        }

        function logout() {
            localStorage.removeItem('nyatter_session');
            location.reload();
        }
    </script>
</body>
</html>
